<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module ActiveRecord::QueryMethods - activerecord-5.0.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><span class="include">ActiveModel::ForbiddenAttributesProtection</span>
  
  
  </ul>
</div>

    <div id="extends-section" class="nav-section">
  <h3>Extended With Modules</h3>

  <ul class="link-list">
    
  
    <li><span class="extend">ActiveSupport::Concern</span>
  
  
  </ul>
</div>

    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-arel_columns">#arel_columns</a>
    
    <li ><a href="#method-i-assert_mutability-21">#assert_mutability!</a>
    
    <li ><a href="#method-i-association_for_table">#association_for_table</a>
    
    <li ><a href="#method-i-bound_attributes">#bound_attributes</a>
    
    <li ><a href="#method-i-build_arel">#build_arel</a>
    
    <li ><a href="#method-i-build_from">#build_from</a>
    
    <li ><a href="#method-i-build_join_query">#build_join_query</a>
    
    <li ><a href="#method-i-build_joins">#build_joins</a>
    
    <li ><a href="#method-i-build_left_outer_joins">#build_left_outer_joins</a>
    
    <li ><a href="#method-i-build_order">#build_order</a>
    
    <li ><a href="#method-i-build_select">#build_select</a>
    
    <li ><a href="#method-i-check_if_method_has_arguments-21">#check_if_method_has_arguments!</a>
    
    <li ><a href="#method-i-convert_join_strings_to_ast">#convert_join_strings_to_ast</a>
    
    <li ><a href="#method-i-create_with">#create_with</a>
    
    <li ><a href="#method-i-distinct">#distinct</a>
    
    <li ><a href="#method-i-does_not_support_reverse-3F">#does_not_support_reverse?</a>
    
    <li ><a href="#method-i-eager_load">#eager_load</a>
    
    <li ><a href="#method-i-extending">#extending</a>
    
    <li ><a href="#method-i-from">#from</a>
    
    <li ><a href="#method-i-group">#group</a>
    
    <li ><a href="#method-i-having">#having</a>
    
    <li ><a href="#method-i-having_clause_factory">#having_clause_factory</a>
    
    <li ><a href="#method-i-includes">#includes</a>
    
    <li ><a href="#method-i-joins">#joins</a>
    
    <li ><a href="#method-i-left_joins">#left_joins</a>
    
    <li ><a href="#method-i-left_outer_joins">#left_outer_joins</a>
    
    <li ><a href="#method-i-limit">#limit</a>
    
    <li ><a href="#method-i-lock">#lock</a>
    
    <li ><a href="#method-i-new_from_clause">#new_from_clause</a>
    
    <li ><a href="#method-i-new_having_clause">#new_having_clause</a>
    
    <li ><a href="#method-i-new_where_clause">#new_where_clause</a>
    
    <li ><a href="#method-i-none">#none</a>
    
    <li ><a href="#method-i-offset">#offset</a>
    
    <li ><a href="#method-i-or">#or</a>
    
    <li ><a href="#method-i-order">#order</a>
    
    <li ><a href="#method-i-preload">#preload</a>
    
    <li ><a href="#method-i-preprocess_order_args">#preprocess_order_args</a>
    
    <li ><a href="#method-i-readonly">#readonly</a>
    
    <li ><a href="#method-i-references">#references</a>
    
    <li ><a href="#method-i-reorder">#reorder</a>
    
    <li ><a href="#method-i-reverse_order">#reverse_order</a>
    
    <li ><a href="#method-i-reverse_sql_order">#reverse_sql_order</a>
    
    <li ><a href="#method-i-rewhere">#rewhere</a>
    
    <li class="calls-super" ><a href="#method-i-select">#select</a>
    
    <li ><a href="#method-i-string_containing_comma-3F">#string_containing_comma?</a>
    
    <li ><a href="#method-i-structurally_incompatible_values_for_or">#structurally_incompatible_values_for_or</a>
    
    <li ><a href="#method-i-symbol_unscoping">#symbol_unscoping</a>
    
    <li ><a href="#method-i-uniq">#uniq</a>
    
    <li ><a href="#method-i-unscope">#unscope</a>
    
    <li ><a href="#method-i-validate_order_args">#validate_order_args</a>
    
    <li ><a href="#method-i-where">#where</a>
    
    <li ><a href="#method-i-where_clause_factory">#where_clause_factory</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-ActiveRecord::QueryMethods">
  <h1 id="module-ActiveRecord::QueryMethods" class="module">
    module ActiveRecord::QueryMethods
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="FROZEN_EMPTY_ARRAY">FROZEN_EMPTY_ARRAY
        
        <dd>
        
      
        <dt id="FROZEN_EMPTY_HASH">FROZEN_EMPTY_HASH
        
        <dd>
        
      
        <dt id="VALID_UNSCOPING_VALUES">VALID_UNSCOPING_VALUES
        
        <dd>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-bound_attributes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bound_attributes</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="bound_attributes-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bound_attributes</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">limit_value</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">string_containing_comma?</span>(<span class="ruby-identifier">limit_value</span>)
    <span class="ruby-identifier">limit_bind</span> = <span class="ruby-constant">Attribute</span>.<span class="ruby-identifier">with_cast_value</span>(
      <span class="ruby-string">&quot;LIMIT&quot;</span>.<span class="ruby-identifier">freeze</span>,
      <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">sanitize_limit</span>(<span class="ruby-identifier">limit_value</span>),
      <span class="ruby-constant">Type</span><span class="ruby-operator">::</span><span class="ruby-constant">Value</span>.<span class="ruby-identifier">new</span>,
    )
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">offset_value</span>
    <span class="ruby-identifier">offset_bind</span> = <span class="ruby-constant">Attribute</span>.<span class="ruby-identifier">with_cast_value</span>(
      <span class="ruby-string">&quot;OFFSET&quot;</span>.<span class="ruby-identifier">freeze</span>,
      <span class="ruby-identifier">offset_value</span>.<span class="ruby-identifier">to_i</span>,
      <span class="ruby-constant">Type</span><span class="ruby-operator">::</span><span class="ruby-constant">Value</span>.<span class="ruby-identifier">new</span>,
    )
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">combine_bind_parameters</span>(
    <span class="ruby-identifier">from_clause</span><span class="ruby-operator">:</span> <span class="ruby-identifier">from_clause</span>.<span class="ruby-identifier">binds</span>,
    <span class="ruby-identifier">join_clause</span><span class="ruby-operator">:</span> <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">bind_values</span>,
    <span class="ruby-identifier">where_clause</span><span class="ruby-operator">:</span> <span class="ruby-identifier">where_clause</span>.<span class="ruby-identifier">binds</span>,
    <span class="ruby-identifier">having_clause</span><span class="ruby-operator">:</span> <span class="ruby-identifier">having_clause</span>.<span class="ruby-identifier">binds</span>,
    <span class="ruby-identifier">limit</span><span class="ruby-operator">:</span> <span class="ruby-identifier">limit_bind</span>,
    <span class="ruby-identifier">offset</span><span class="ruby-operator">:</span> <span class="ruby-identifier">offset_bind</span>,
  )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_with" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_with</span><span
            class="method-args">(value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets attributes to be used when creating new records from a relation
object.</p>

<pre class="ruby"><span class="ruby-identifier">users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Oscar&#39;</span>)
<span class="ruby-identifier">users</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">name</span> <span class="ruby-comment"># =&gt; &#39;Oscar&#39;</span>

<span class="ruby-identifier">users</span> = <span class="ruby-identifier">users</span>.<span class="ruby-identifier">create_with</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;DHH&#39;</span>)
<span class="ruby-identifier">users</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">name</span> <span class="ruby-comment"># =&gt; &#39;DHH&#39;</span>
</pre>

<p>You can pass <code>nil</code> to <a
href="QueryMethods.html#method-i-create_with">create_with</a> to reset
attributes:</p>

<pre class="ruby"><span class="ruby-identifier">users</span> = <span class="ruby-identifier">users</span>.<span class="ruby-identifier">create_with</span>(<span class="ruby-keyword">nil</span>)
<span class="ruby-identifier">users</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">name</span> <span class="ruby-comment"># =&gt; &#39;Oscar&#39;</span>
</pre>
          
          

          
          <div class="method-source-code" id="create_with-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 818</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_with</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">create_with!</span>(<span class="ruby-identifier">value</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-distinct" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">distinct</span><span
            class="method-args">(value = true)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Specifies whether the records should be unique or not. For example:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">select</span>(:<span class="ruby-identifier">name</span>)
<span class="ruby-comment"># Might return two records with the same name</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">select</span>(:<span class="ruby-identifier">name</span>).<span class="ruby-identifier">distinct</span>
<span class="ruby-comment"># Returns 1 record per distinct name</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">select</span>(:<span class="ruby-identifier">name</span>).<span class="ruby-identifier">distinct</span>.<span class="ruby-identifier">distinct</span>(<span class="ruby-keyword">false</span>)
<span class="ruby-comment"># You can also remove the uniqueness</span>
</pre>
          
          

          
          <div class="method-source-code" id="distinct-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 865</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">distinct</span>(<span class="ruby-identifier">value</span> = <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">distinct!</span>(<span class="ruby-identifier">value</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="QueryMethods.html#method-i-uniq">uniq</a>
        </div>
        

        
      </div>

    
      <div id="method-i-eager_load" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">eager_load</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Forces eager loading by performing a LEFT OUTER JOIN on <code>args</code>:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">eager_load</span>(:<span class="ruby-identifier">posts</span>)
<span class="ruby-comment"># SELECT &quot;users&quot;.&quot;id&quot; AS t0_r0, &quot;users&quot;.&quot;name&quot; AS t0_r1, ...</span>
<span class="ruby-comment"># FROM &quot;users&quot; LEFT OUTER JOIN &quot;posts&quot; ON &quot;posts&quot;.&quot;user_id&quot; =</span>
<span class="ruby-comment"># &quot;users&quot;.&quot;id&quot;</span>
</pre>
          
          

          
          <div class="method-source-code" id="eager_load-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 185</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">eager_load</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">check_if_method_has_arguments!</span>(<span class="ruby-value">:eager_load</span>, <span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">eager_load!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-extending" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">extending</span><span
            class="method-args">(*modules, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Used to extend a scope with additional methods, either through a module or
through a block provided.</p>

<p>The object returned is a relation, which can be further extended.</p>

<h3 id="method-i-extending-label-Using+a+module">Using a module<span><a href="#method-i-extending-label-Using+a+module">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-keyword">module</span> <span class="ruby-constant">Pagination</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">page</span>(<span class="ruby-identifier">number</span>)
    <span class="ruby-comment"># pagination code goes here</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">scope</span> = <span class="ruby-constant">Model</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">extending</span>(<span class="ruby-constant">Pagination</span>)
<span class="ruby-identifier">scope</span>.<span class="ruby-identifier">page</span>(<span class="ruby-identifier">params</span>[:<span class="ruby-identifier">page</span>])
</pre>

<p>You can also pass a list of modules:</p>

<pre class="ruby"><span class="ruby-identifier">scope</span> = <span class="ruby-constant">Model</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">extending</span>(<span class="ruby-constant">Pagination</span>, <span class="ruby-constant">SomethingElse</span>)
</pre>

<h3 id="method-i-extending-label-Using+a+block">Using a block<span><a href="#method-i-extending-label-Using+a+block">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-identifier">scope</span> = <span class="ruby-constant">Model</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">extending</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">page</span>(<span class="ruby-identifier">number</span>)
    <span class="ruby-comment"># pagination code goes here</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
<span class="ruby-identifier">scope</span>.<span class="ruby-identifier">page</span>(<span class="ruby-identifier">params</span>[:<span class="ruby-identifier">page</span>])
</pre>

<p>You can also use a block and a module list:</p>

<pre class="ruby"><span class="ruby-identifier">scope</span> = <span class="ruby-constant">Model</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">extending</span>(<span class="ruby-constant">Pagination</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">per_page</span>(<span class="ruby-identifier">number</span>)
    <span class="ruby-comment"># pagination code goes here</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>
          
          

          
          <div class="method-source-code" id="extending-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 915</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">extending</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">modules</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">modules</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">block</span>
    <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">extending!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">modules</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-from" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">from</span><span
            class="method-args">(value, subquery_name = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Specifies table from which the records will be fetched. For example:</p>

<pre class="ruby"><span class="ruby-constant">Topic</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&#39;title&#39;</span>).<span class="ruby-identifier">from</span>(<span class="ruby-string">&#39;posts&#39;</span>)
<span class="ruby-comment"># SELECT title FROM posts</span>
</pre>

<p>Can accept other relation objects. For example:</p>

<pre class="ruby"><span class="ruby-constant">Topic</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&#39;title&#39;</span>).<span class="ruby-identifier">from</span>(<span class="ruby-constant">Topic</span>.<span class="ruby-identifier">approved</span>)
<span class="ruby-comment"># SELECT title FROM (SELECT * FROM topics WHERE approved = &#39;t&#39;) subquery</span>

<span class="ruby-constant">Topic</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&#39;a.title&#39;</span>).<span class="ruby-identifier">from</span>(<span class="ruby-constant">Topic</span>.<span class="ruby-identifier">approved</span>, :<span class="ruby-identifier">a</span>)
<span class="ruby-comment"># SELECT a.title FROM (SELECT * FROM topics WHERE approved = &#39;t&#39;) a</span>
</pre>
          
          

          
          <div class="method-source-code" id="from-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 846</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">from</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">subquery_name</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">from!</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">subquery_name</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-group" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">group</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Allows to specify a group attribute:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">group</span>(:<span class="ruby-identifier">name</span>)
<span class="ruby-comment"># SELECT &quot;users&quot;.* FROM &quot;users&quot; GROUP BY name</span>
</pre>

<p>Returns an array with distinct records based on the <code>group</code>
attribute:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">select</span>([:<span class="ruby-identifier">id</span>, :<span class="ruby-identifier">name</span>])
<span class="ruby-comment"># =&gt; [#&lt;User id: 1, name: &quot;Oscar&quot;&gt;, #&lt;User id: 2, name: &quot;Oscar&quot;&gt;, #&lt;User id: 3, name: &quot;Foo&quot;&gt;]</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">group</span>(:<span class="ruby-identifier">name</span>)
<span class="ruby-comment"># =&gt; [#&lt;User id: 3, name: &quot;Foo&quot;, ...&gt;, #&lt;User id: 2, name: &quot;Oscar&quot;, ...&gt;]</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;name AS grouped_name, age&#39;</span>)
<span class="ruby-comment"># =&gt; [#&lt;User id: 3, name: &quot;Foo&quot;, age: 21, ...&gt;, #&lt;User id: 2, name: &quot;Oscar&quot;, age: 21, ...&gt;, #&lt;User id: 5, name: &quot;Foo&quot;, age: 23, ...&gt;]</span>
</pre>

<p>Passing in an array of attributes to group by is also supported.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">select</span>([:<span class="ruby-identifier">id</span>, :<span class="ruby-identifier">first_name</span>]).<span class="ruby-identifier">group</span>(:<span class="ruby-identifier">id</span>, :<span class="ruby-identifier">first_name</span>).<span class="ruby-identifier">first</span>(<span class="ruby-value">3</span>)
<span class="ruby-comment"># =&gt; [#&lt;User id: 1, first_name: &quot;Bill&quot;&gt;, #&lt;User id: 2, first_name: &quot;Earl&quot;&gt;, #&lt;User id: 3, first_name: &quot;Beto&quot;&gt;]</span>
</pre>
          
          

          
          <div class="method-source-code" id="group-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 306</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">group</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">check_if_method_has_arguments!</span>(<span class="ruby-value">:group</span>, <span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">group!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-having" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">having</span><span
            class="method-args">(opts, *rest)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Allows to specify a HAVING clause. Note that you can&#39;t use HAVING
without also specifying a GROUP clause.</p>

<pre class="ruby"><span class="ruby-constant">Order</span>.<span class="ruby-identifier">having</span>(<span class="ruby-string">&#39;SUM(price) &gt; 30&#39;</span>).<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;user_id&#39;</span>)
</pre>
          
          

          
          <div class="method-source-code" id="having-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 688</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">having</span>(<span class="ruby-identifier">opts</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">rest</span>)
  <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">self</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">having!</span>(<span class="ruby-identifier">opts</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">rest</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-includes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">includes</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Specify relationships to be included in the result set. For example:</p>

<pre class="ruby"><span class="ruby-identifier">users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">includes</span>(:<span class="ruby-identifier">address</span>)
<span class="ruby-identifier">users</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">user</span>.<span class="ruby-identifier">address</span>.<span class="ruby-identifier">city</span>
<span class="ruby-keyword">end</span>
</pre>

<p>allows you to access the <code>address</code> attribute of the
<code>User</code> model without firing an additional query. This will often
result in a performance improvement over a simple join.</p>

<p>You can also specify multiple relationships, like this:</p>

<pre class="ruby"><span class="ruby-identifier">users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">includes</span>(:<span class="ruby-identifier">address</span>, :<span class="ruby-identifier">friends</span>)
</pre>

<p>Loading nested relationships is possible using a Hash:</p>

<pre class="ruby"><span class="ruby-identifier">users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">includes</span>(:<span class="ruby-identifier">address</span>, <span class="ruby-identifier">friends</span><span class="ruby-operator">:</span> [:<span class="ruby-identifier">address</span>, :<span class="ruby-identifier">followers</span>])
</pre>

<h3 id="method-i-includes-label-conditions">conditions<span><a href="#method-i-includes-label-conditions">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>If you want to add conditions to your included models you&#39;ll have to
explicitly reference them. For example:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">includes</span>(:<span class="ruby-identifier">posts</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;posts.name = ?&#39;</span>, <span class="ruby-string">&#39;example&#39;</span>)
</pre>

<p>Will throw an error, but this will work:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">includes</span>(:<span class="ruby-identifier">posts</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;posts.name = ?&#39;</span>, <span class="ruby-string">&#39;example&#39;</span>).<span class="ruby-identifier">references</span>(:<span class="ruby-identifier">posts</span>)
</pre>

<p>Note that <a href="QueryMethods.html#method-i-includes">includes</a> works
with association names while <a
href="QueryMethods.html#method-i-references">references</a> needs the
actual table name.</p>
          
          

          
          <div class="method-source-code" id="includes-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 166</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">includes</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">check_if_method_has_arguments!</span>(<span class="ruby-value">:includes</span>, <span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">includes!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-joins" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">joins</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Performs a joins on <code>args</code>. The given symbol(s) should match the
name of the association(s).</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">joins</span>(:<span class="ruby-identifier">posts</span>)
<span class="ruby-comment"># SELECT &quot;users&quot;.*</span>
<span class="ruby-comment"># FROM &quot;users&quot;</span>
<span class="ruby-comment"># INNER JOIN &quot;posts&quot; ON &quot;posts&quot;.&quot;user_id&quot; = &quot;users&quot;.&quot;id&quot;</span>
</pre>

<p>Multiple joins:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">joins</span>(:<span class="ruby-identifier">posts</span>, :<span class="ruby-identifier">account</span>)
<span class="ruby-comment"># SELECT &quot;users&quot;.*</span>
<span class="ruby-comment"># FROM &quot;users&quot;</span>
<span class="ruby-comment"># INNER JOIN &quot;posts&quot; ON &quot;posts&quot;.&quot;user_id&quot; = &quot;users&quot;.&quot;id&quot;</span>
<span class="ruby-comment"># INNER JOIN &quot;accounts&quot; ON &quot;accounts&quot;.&quot;id&quot; = &quot;users&quot;.&quot;account_id&quot;</span>
</pre>

<p>Nested joins:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">posts</span><span class="ruby-operator">:</span> [:<span class="ruby-identifier">comments</span>])
<span class="ruby-comment"># SELECT &quot;users&quot;.*</span>
<span class="ruby-comment"># FROM &quot;users&quot;</span>
<span class="ruby-comment"># INNER JOIN &quot;posts&quot; ON &quot;posts&quot;.&quot;user_id&quot; = &quot;users&quot;.&quot;id&quot;</span>
<span class="ruby-comment"># INNER JOIN &quot;comments&quot; &quot;comments_posts&quot;</span>
<span class="ruby-comment">#   ON &quot;comments_posts&quot;.&quot;post_id&quot; = &quot;posts&quot;.&quot;id&quot;</span>
</pre>

<p>You can use strings in order to customize your joins:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-string">&quot;LEFT JOIN bookmarks ON bookmarks.bookmarkable_type = &#39;Post&#39; AND bookmarks.user_id = users.id&quot;</span>)
<span class="ruby-comment"># SELECT &quot;users&quot;.* FROM &quot;users&quot; LEFT JOIN bookmarks ON bookmarks.bookmarkable_type = &#39;Post&#39; AND bookmarks.user_id = users.id</span>
</pre>
          
          

          
          <div class="method-source-code" id="joins-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 467</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">joins</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">check_if_method_has_arguments!</span>(<span class="ruby-value">:joins</span>, <span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">joins!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-left_joins" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">left_joins</span><span
            class="method-args">(*args)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="QueryMethods.html#method-i-left_outer_joins">left_outer_joins</a>
        </div>
        
      </div>

    
      <div id="method-i-left_outer_joins" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">left_outer_joins</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Performs a left outer joins on <code>args</code>:</p>

<pre>User.left_outer_joins(:posts)
=&gt; SELECT &quot;users&quot;.* FROM &quot;users&quot; LEFT OUTER JOIN &quot;posts&quot; ON &quot;posts&quot;.&quot;user_id&quot; = &quot;users&quot;.&quot;id&quot;</pre>
          
          

          
          <div class="method-source-code" id="left_outer_joins-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 484</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">left_outer_joins</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">check_if_method_has_arguments!</span>(<span class="ruby-value">:left_outer_joins</span>, <span class="ruby-identifier">args</span>)

  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">compact!</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">flatten!</span>

  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">left_outer_joins!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="QueryMethods.html#method-i-left_joins">left_joins</a>
        </div>
        

        
      </div>

    
      <div id="method-i-limit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">limit</span><span
            class="method-args">(value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Specifies a limit for the number of records to retrieve.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">limit</span>(<span class="ruby-value">10</span>) <span class="ruby-comment"># generated SQL has &#39;LIMIT 10&#39;</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">limit</span>(<span class="ruby-value">10</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-value">20</span>) <span class="ruby-comment"># generated SQL has &#39;LIMIT 20&#39;</span>
</pre>
          
          

          
          <div class="method-source-code" id="limit-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 705</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">limit</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">limit!</span>(<span class="ruby-identifier">value</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-lock" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">lock</span><span
            class="method-args">(locks = true)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Specifies locking settings (default to <code>true</code>). For more
information on locking, please see <a
href="Locking.html">ActiveRecord::Locking</a>.</p>
          
          

          
          <div class="method-source-code" id="lock-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 739</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">lock</span>(<span class="ruby-identifier">locks</span> = <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">lock!</span>(<span class="ruby-identifier">locks</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-none" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">none</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a chainable relation with zero records.</p>

<p>The returned relation implements the Null Object pattern. It is an object
with defined null behavior and always returns an empty array of records
without querying the database.</p>

<p>Any subsequent condition chained to the returned relation will continue
generating an empty relation and will not fire any query to the database.</p>

<p>Used in cases where a method or scope could return zero records but the
result needs to be chainable.</p>

<p>For example:</p>

<pre class="ruby"><span class="ruby-ivar">@posts</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">visible_posts</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[:<span class="ruby-identifier">name</span>])
<span class="ruby-comment"># the visible_posts method is expected to return a chainable Relation</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">visible_posts</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">role</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;Country Manager&#39;</span>
    <span class="ruby-constant">Post</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">country</span><span class="ruby-operator">:</span> <span class="ruby-identifier">country</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;Reviewer&#39;</span>
    <span class="ruby-constant">Post</span>.<span class="ruby-identifier">published</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;Bad User&#39;</span>
    <span class="ruby-constant">Post</span>.<span class="ruby-identifier">none</span> <span class="ruby-comment"># It can&#39;t be chained if [] is returned.</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>
          
          

          
          <div class="method-source-code" id="none-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 782</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">none</span>
  <span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;1=0&quot;</span>).<span class="ruby-identifier">extending!</span>(<span class="ruby-constant">NullRelation</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-offset" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">offset</span><span
            class="method-args">(value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Specifies the number of rows to skip before returning rows.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">offset</span>(<span class="ruby-value">10</span>) <span class="ruby-comment"># generated SQL has &quot;OFFSET 10&quot;</span>
</pre>

<p>Should be used with order.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">offset</span>(<span class="ruby-value">10</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;name ASC&quot;</span>)
</pre>
          
          

          
          <div class="method-source-code" id="offset-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 728</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">offset</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">offset!</span>(<span class="ruby-identifier">value</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-or" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">or</span><span
            class="method-args">(other)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a new relation, which is the logical union of this relation and the
one passed as an argument.</p>

<p>The two relations must be structurally compatible: they must be scoping the
same model, and they must differ only by <a
href="QueryMethods.html#method-i-where">where</a> (if no <a
href="QueryMethods.html#method-i-group">group</a> has been defined) or <a
href="QueryMethods.html#method-i-having">having</a> (if a <a
href="QueryMethods.html#method-i-group">group</a> is present). Neither
relation may have a <a href="QueryMethods.html#method-i-limit">limit</a>,
<a href="QueryMethods.html#method-i-offset">offset</a>, or <a
href="QueryMethods.html#method-i-distinct">distinct</a> set.</p>

<pre class="ruby"><span class="ruby-constant">Post</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;id = 1&quot;</span>).<span class="ruby-identifier">or</span>(<span class="ruby-constant">Post</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;author_id = 3&quot;</span>))
<span class="ruby-comment"># SELECT `posts`.* FROM `posts`  WHERE ((&#39;id = 1&#39; OR &#39;author_id = 3&#39;))</span>
</pre>
          
          

          
          <div class="method-source-code" id="or-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 663</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">or</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Relation</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;You have passed #{other.class.name} object to #or. Pass an ActiveRecord::Relation object instead.&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">or!</span>(<span class="ruby-identifier">other</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-order" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">order</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Allows to specify an order attribute:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">order</span>(:<span class="ruby-identifier">name</span>)
<span class="ruby-comment"># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY &quot;users&quot;.&quot;name&quot; ASC</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">order</span>(<span class="ruby-identifier">email</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">desc</span>)
<span class="ruby-comment"># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY &quot;users&quot;.&quot;email&quot; DESC</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">order</span>(:<span class="ruby-identifier">name</span>, <span class="ruby-identifier">email</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">desc</span>)
<span class="ruby-comment"># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY &quot;users&quot;.&quot;name&quot; ASC, &quot;users&quot;.&quot;email&quot; DESC</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;name&#39;</span>)
<span class="ruby-comment"># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY name</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;name DESC&#39;</span>)
<span class="ruby-comment"># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY name DESC</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;name DESC, email&#39;</span>)
<span class="ruby-comment"># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY name DESC, email</span>
</pre>
          
          

          
          <div class="method-source-code" id="order-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 337</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">check_if_method_has_arguments!</span>(<span class="ruby-value">:order</span>, <span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">order!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-preload" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">preload</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Allows preloading of <code>args</code>, in the same way that <a
href="QueryMethods.html#method-i-includes">includes</a> does:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">preload</span>(:<span class="ruby-identifier">posts</span>)
<span class="ruby-comment"># SELECT &quot;posts&quot;.* FROM &quot;posts&quot; WHERE &quot;posts&quot;.&quot;user_id&quot; IN (1, 2, 3)</span>
</pre>
          
          

          
          <div class="method-source-code" id="preload-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 199</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">preload</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">check_if_method_has_arguments!</span>(<span class="ruby-value">:preload</span>, <span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">preload!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-readonly" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">readonly</span><span
            class="method-args">(value = true)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets readonly attributes for the returned relation. If value is true
(default), attempting to update a record will result in an error.</p>

<pre>users = User.readonly
users.first.save
=&gt; ActiveRecord::ReadOnlyRecord: User is marked as readonly</pre>
          
          

          
          <div class="method-source-code" id="readonly-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 796</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">readonly</span>(<span class="ruby-identifier">value</span> = <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">readonly!</span>(<span class="ruby-identifier">value</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-references" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">references</span><span
            class="method-args">(*table_names)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Use to indicate that the given <code>table_names</code> are referenced by
an SQL string, and should therefore be JOINed in any query rather than
loaded separately. This method only works in conjunction with <a
href="QueryMethods.html#method-i-includes">includes</a>. See <a
href="QueryMethods.html#method-i-includes">includes</a> for more details.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">includes</span>(:<span class="ruby-identifier">posts</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;posts.name = &#39;foo&#39;&quot;</span>)
<span class="ruby-comment"># Doesn&#39;t JOIN the posts table, resulting in an error.</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">includes</span>(:<span class="ruby-identifier">posts</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;posts.name = &#39;foo&#39;&quot;</span>).<span class="ruby-identifier">references</span>(:<span class="ruby-identifier">posts</span>)
<span class="ruby-comment"># Query now knows the string references posts, so adds a JOIN</span>
</pre>
          
          

          
          <div class="method-source-code" id="references-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 219</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">references</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">table_names</span>)
  <span class="ruby-identifier">check_if_method_has_arguments!</span>(<span class="ruby-value">:references</span>, <span class="ruby-identifier">table_names</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">references!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">table_names</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reorder" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reorder</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Replaces any existing order defined on the relation with the specified
order.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;email DESC&#39;</span>).<span class="ruby-identifier">reorder</span>(<span class="ruby-string">&#39;id ASC&#39;</span>) <span class="ruby-comment"># generated SQL has &#39;ORDER BY id ASC&#39;</span>
</pre>

<p>Subsequent calls to order on the same relation will be appended. For
example:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;email DESC&#39;</span>).<span class="ruby-identifier">reorder</span>(<span class="ruby-string">&#39;id ASC&#39;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;name ASC&#39;</span>)
</pre>

<p>generates a query with &#39;ORDER BY id ASC, name ASC&#39;.</p>
          
          

          
          <div class="method-source-code" id="reorder-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 358</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reorder</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">check_if_method_has_arguments!</span>(<span class="ruby-value">:reorder</span>, <span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">reorder!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reverse_order" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reverse_order</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reverse the existing order clause on the relation.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;name ASC&#39;</span>).<span class="ruby-identifier">reverse_order</span> <span class="ruby-comment"># generated SQL has &#39;ORDER BY name DESC&#39;</span>
</pre>
          
          

          
          <div class="method-source-code" id="reverse_order-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 936</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reverse_order</span>
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">reverse_order!</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-rewhere" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rewhere</span><span
            class="method-args">(conditions)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Allows you to change a previously set where condition for a given
attribute, instead of appending to that condition.</p>

<pre class="ruby"><span class="ruby-constant">Post</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">trashed</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">trashed</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
<span class="ruby-comment"># WHERE `trashed` = 1 AND `trashed` = 0</span>

<span class="ruby-constant">Post</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">trashed</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">rewhere</span>(<span class="ruby-identifier">trashed</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
<span class="ruby-comment"># WHERE `trashed` = 0</span>

<span class="ruby-constant">Post</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">trashed</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">rewhere</span>(<span class="ruby-identifier">trashed</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
<span class="ruby-comment"># WHERE `active` = 1 AND `trashed` = 0</span>
</pre>

<p>This is short-hand for <code>unscope(where:
conditions.keys).where(conditions)</code>. Note that unlike reorder,
we&#39;re only unscoping the named conditions  not the entire where
statement.</p>
          
          

          
          <div class="method-source-code" id="rewhere-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 649</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rewhere</span>(<span class="ruby-identifier">conditions</span>)
  <span class="ruby-identifier">unscope</span>(<span class="ruby-identifier">where</span><span class="ruby-operator">:</span> <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">keys</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">conditions</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-select" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select</span><span
            class="method-args">(*fields)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Works in two unique ways.</p>

<p>First: takes a block so it can be used just like +Array#select+.</p>

<pre class="ruby"><span class="ruby-constant">Model</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">field</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">value</span> }
</pre>

<p>This will build an array of objects from the database for the scope,
converting them into an array and iterating through them using
+Array#select+.</p>

<p>Second: Modifies the SELECT statement for the query so that only certain
fields are retrieved:</p>

<pre class="ruby"><span class="ruby-constant">Model</span>.<span class="ruby-identifier">select</span>(:<span class="ruby-identifier">field</span>)
<span class="ruby-comment"># =&gt; [#&lt;Model id: nil, field: &quot;value&quot;&gt;]</span>
</pre>

<p>Although in the above example it looks as though this method returns an
array, it actually returns a relation object and can have other query
methods appended to it, such as the other methods in <a
href="QueryMethods.html">ActiveRecord::QueryMethods</a>.</p>

<p>The argument to the method can also be an array of fields.</p>

<pre class="ruby"><span class="ruby-constant">Model</span>.<span class="ruby-identifier">select</span>(:<span class="ruby-identifier">field</span>, :<span class="ruby-identifier">other_field</span>, :<span class="ruby-identifier">and_one_more</span>)
<span class="ruby-comment"># =&gt; [#&lt;Model id: nil, field: &quot;value&quot;, other_field: &quot;value&quot;, and_one_more: &quot;value&quot;&gt;]</span>
</pre>

<p>You can also use one or more strings, which will be used unchanged as
SELECT fields.</p>

<pre class="ruby"><span class="ruby-constant">Model</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&#39;field AS field_one&#39;</span>, <span class="ruby-string">&#39;other_field AS field_two&#39;</span>)
<span class="ruby-comment"># =&gt; [#&lt;Model id: nil, field: &quot;value&quot;, other_field: &quot;value&quot;&gt;]</span>
</pre>

<p>If an alias was specified, it will be accessible from the resulting
objects:</p>

<pre class="ruby"><span class="ruby-constant">Model</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&#39;field AS field_one&#39;</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">field_one</span>
<span class="ruby-comment"># =&gt; &quot;value&quot;</span>
</pre>

<p>Accessing attributes of an object that do not have fields retrieved by a
select except <code>id</code> will throw
ActiveModel::MissingAttributeError:</p>

<pre class="ruby"><span class="ruby-constant">Model</span>.<span class="ruby-identifier">select</span>(:<span class="ruby-identifier">field</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">other_field</span>
<span class="ruby-comment"># =&gt; ActiveModel::MissingAttributeError: missing attribute: other_field</span>
</pre>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="select-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 271</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">select</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">fields</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&#39;Call this with at least one field&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">_select!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">fields</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-uniq" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">uniq</span><span
            class="method-args">(value = true)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="QueryMethods.html#method-i-distinct">distinct</a>
        </div>
        
      </div>

    
      <div id="method-i-unscope" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unscope</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Removes an unwanted relation that is already defined on a chain of
relations. This is useful when passing around chains of relations and would
like to modify the relations without reconstructing the entire chain.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;email DESC&#39;</span>).<span class="ruby-identifier">unscope</span>(:<span class="ruby-identifier">order</span>) <span class="ruby-operator">==</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">all</span>
</pre>

<p>The method arguments are symbols which correspond to the names of the
methods which should be unscoped. The valid arguments are given in <a
href="QueryMethods.html#VALID_UNSCOPING_VALUES">VALID_UNSCOPING_VALUES</a>.
The method can also be called with multiple arguments. For example:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;email DESC&#39;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-string">&#39;id&#39;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;John&quot;</span>)
    .<span class="ruby-identifier">unscope</span>(:<span class="ruby-identifier">order</span>, :<span class="ruby-identifier">select</span>, :<span class="ruby-identifier">where</span>) <span class="ruby-operator">==</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">all</span>
</pre>

<p>One can additionally pass a hash as an argument to unscope specific
<code>:where</code> values. This is done by passing a hash with a single
key-value pair. The key should be <code>:where</code> and the value should
be the where value to unscope. For example:</p>

<pre>User.where(name: &quot;John&quot;, active: true).unscope(where: :name)
    == User.where(active: true)</pre>

<p>This method is similar to except, but unlike except, it persists across
merges:</p>

<pre>User.order(&#39;email&#39;).merge(User.except(:order))
    == User.order(&#39;email&#39;)

User.order(&#39;email&#39;).merge(User.unscope(:order))
    == User.all</pre>

<p>This means it can be used in association definitions:</p>

<pre class="ruby"><span class="ruby-identifier">has_many</span> :<span class="ruby-identifier">comments</span>, <span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">unscope</span>(<span class="ruby-identifier">where</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">trashed</span>) }
</pre>
          
          

          
          <div class="method-source-code" id="unscope-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 408</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unscope</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">check_if_method_has_arguments!</span>(<span class="ruby-value">:unscope</span>, <span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">unscope!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-where" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">where</span><span
            class="method-args">(opts = :chain, *rest)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a new relation, which is the result of filtering the current
relation according to the conditions in the arguments.</p>

<p><a href="QueryMethods.html#method-i-where">where</a> accepts conditions in
one of several formats. In the examples below, the resulting SQL is given
as an illustration; the actual query generated may be different depending
on the database adapter.</p>

<h3 id="method-i-where-label-string">string<span><a href="#method-i-where-label-string">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>A single string, without additional arguments, is passed to the query
constructor as an SQL fragment, and used in the where clause of the query.</p>

<pre class="ruby"><span class="ruby-constant">Client</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;orders_count = &#39;2&#39;&quot;</span>)
<span class="ruby-comment"># SELECT * from clients where orders_count = &#39;2&#39;;</span>
</pre>

<p>Note that building your own string from user input may expose your
application to injection attacks if not done properly. As an alternative,
it is recommended to use one of the following methods.</p>

<h3 id="method-i-where-label-array">array<span><a href="#method-i-where-label-array">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>If an array is passed, then the first element of the array is treated as a
template, and the remaining elements are inserted into the template to
generate the condition. Active Record takes care of building the query to
avoid injection attacks, and will convert from the ruby type to the
database type where needed. Elements are inserted into the string in the
order in which they appear.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;name = ? and email = ?&quot;</span>, <span class="ruby-string">&quot;Joe&quot;</span>, <span class="ruby-string">&quot;joe@example.com&quot;</span>])
<span class="ruby-comment"># SELECT * FROM users WHERE name = &#39;Joe&#39; AND email = &#39;joe@example.com&#39;;</span>
</pre>

<p>Alternatively, you can use named placeholders in the template, and pass a
hash as the second element of the array. The names in the template are
replaced with the corresponding values from the hash.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;name = :name and email = :email&quot;</span>, { <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Joe&quot;</span>, <span class="ruby-identifier">email</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;joe@example.com&quot;</span> }])
<span class="ruby-comment"># SELECT * FROM users WHERE name = &#39;Joe&#39; AND email = &#39;joe@example.com&#39;;</span>
</pre>

<p>This can make for more readable code in complex queries.</p>

<p>Lastly, you can use sprintf-style % escapes in the template. This works
slightly differently than the previous methods; you are responsible for
ensuring that the values in the template are properly quoted. The values
are passed to the connector for quoting, but the caller is responsible for
ensuring they are enclosed in quotes in the resulting SQL. After quoting,
the values are inserted using the same escapes as the Ruby core method
<code>Kernel::sprintf</code>.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;name = &#39;%s&#39; and email = &#39;%s&#39;&quot;</span>, <span class="ruby-string">&quot;Joe&quot;</span>, <span class="ruby-string">&quot;joe@example.com&quot;</span>])
<span class="ruby-comment"># SELECT * FROM users WHERE name = &#39;Joe&#39; AND email = &#39;joe@example.com&#39;;</span>
</pre>

<p>If <a href="QueryMethods.html#method-i-where">where</a> is called with
multiple arguments, these are treated as if they were passed as the
elements of a single array.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;name = :name and email = :email&quot;</span>, { <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Joe&quot;</span>, <span class="ruby-identifier">email</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;joe@example.com&quot;</span> })
<span class="ruby-comment"># SELECT * FROM users WHERE name = &#39;Joe&#39; AND email = &#39;joe@example.com&#39;;</span>
</pre>

<p>When using strings to specify conditions, you can use any operator
available from the database. While this provides the most flexibility, you
can also unintentionally introduce dependencies on the underlying database.
If your code is intended for general consumption, test with multiple
database backends.</p>

<h3 id="method-i-where-label-hash">hash<span><a href="#method-i-where-label-hash">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><a href="QueryMethods.html#method-i-where">where</a> will also accept a
hash condition, in which the keys are fields and the values are values to
be searched for.</p>

<p>Fields can be symbols or strings. Values can be single values, arrays, or
ranges.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>({ <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Joe&quot;</span>, <span class="ruby-identifier">email</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;joe@example.com&quot;</span> })
<span class="ruby-comment"># SELECT * FROM users WHERE name = &#39;Joe&#39; AND email = &#39;joe@example.com&#39;</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>({ <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> [<span class="ruby-string">&quot;Alice&quot;</span>, <span class="ruby-string">&quot;Bob&quot;</span>]})
<span class="ruby-comment"># SELECT * FROM users WHERE name IN (&#39;Alice&#39;, &#39;Bob&#39;)</span>

<span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>({ <span class="ruby-identifier">created_at</span><span class="ruby-operator">:</span> (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">midnight</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">day</span>)<span class="ruby-operator">..</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">midnight</span> })
<span class="ruby-comment"># SELECT * FROM users WHERE (created_at BETWEEN &#39;2012-06-09 07:00:00.000000&#39; AND &#39;2012-06-10 07:00:00.000000&#39;)</span>
</pre>

<p>In the case of a belongs_to relationship, an association key can be used to
specify the model if an <a href="../ActiveRecord.html">ActiveRecord</a>
object is used as the value.</p>

<pre class="ruby"><span class="ruby-identifier">author</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)

<span class="ruby-comment"># The following queries will be equivalent:</span>
<span class="ruby-constant">Post</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">author</span><span class="ruby-operator">:</span> <span class="ruby-identifier">author</span>)
<span class="ruby-constant">Post</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">author_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">author</span>)
</pre>

<p>This also works with polymorphic belongs_to relationships:</p>

<pre class="ruby"><span class="ruby-identifier">treasure</span> = <span class="ruby-constant">Treasure</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;gold coins&#39;</span>)
<span class="ruby-identifier">treasure</span>.<span class="ruby-identifier">price_estimates</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">PriceEstimate</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">price</span><span class="ruby-operator">:</span> <span class="ruby-value">125</span>)

<span class="ruby-comment"># The following queries will be equivalent:</span>
<span class="ruby-constant">PriceEstimate</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">estimate_of</span><span class="ruby-operator">:</span> <span class="ruby-identifier">treasure</span>)
<span class="ruby-constant">PriceEstimate</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">estimate_of_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Treasure&#39;</span>, <span class="ruby-identifier">estimate_of_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">treasure</span>)
</pre>

<h3 id="method-i-where-label-Joins">Joins<span><a href="#method-i-where-label-Joins">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>If the relation is the result of a join, you may create a condition which
uses any of the tables in the join. For string and array conditions, use
the table name in the condition.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">joins</span>(:<span class="ruby-identifier">posts</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;posts.created_at &lt; ?&quot;</span>, <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
</pre>

<p>For hash conditions, you can either use the table name in the key, or use a
sub-hash.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">joins</span>(:<span class="ruby-identifier">posts</span>).<span class="ruby-identifier">where</span>({ <span class="ruby-string">&quot;posts.published&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> })
<span class="ruby-constant">User</span>.<span class="ruby-identifier">joins</span>(:<span class="ruby-identifier">posts</span>).<span class="ruby-identifier">where</span>({ <span class="ruby-identifier">posts</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">published</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span> } })
</pre>

<h3 id="method-i-where-label-no+argument">no argument<span><a href="#method-i-where-label-no+argument">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>If no argument is passed, <a
href="QueryMethods.html#method-i-where">where</a> returns a new instance of
<a href="QueryMethods/WhereChain.html">WhereChain</a>, that can be chained
with not to return a new relation that negates the where clause.</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Jon&quot;</span>)
<span class="ruby-comment"># SELECT * FROM users WHERE name != &#39;Jon&#39;</span>
</pre>

<p>See <a href="QueryMethods/WhereChain.html">WhereChain</a> for more details
on not.</p>

<h3 id="method-i-where-label-blank+condition">blank condition<span><a href="#method-i-where-label-blank+condition">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>If the condition is any blank-ish object, then <a
href="QueryMethods.html#method-i-where">where</a> is a no-op and returns
the current relation.</p>
          
          

          
          <div class="method-source-code" id="where-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 619</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">where</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-value">:chain</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">rest</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-value">:chain</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">opts</span>
    <span class="ruby-constant">WhereChain</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">spawn</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">spawn</span>.<span class="ruby-identifier">where!</span>(<span class="ruby-identifier">opts</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">rest</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-arel_columns" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">arel_columns</span><span
            class="method-args">(columns)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="arel_columns-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1104</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">arel_columns</span>(<span class="ruby-identifier">columns</span>)
  <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-constant">Symbol</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">field</span> <span class="ruby-operator">||</span> <span class="ruby-constant">String</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">field</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">klass</span>.<span class="ruby-identifier">has_attribute?</span>(<span class="ruby-identifier">field</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">attribute_alias?</span>(<span class="ruby-identifier">field</span>)) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">from_clause</span>.<span class="ruby-identifier">value</span>
      <span class="ruby-identifier">arel_attribute</span>(<span class="ruby-identifier">field</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-constant">Symbol</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">field</span>
      <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">quote_table_name</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">to_s</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">field</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-assert_mutability-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">assert_mutability!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="assert_mutability-21-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 954</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">assert_mutability!</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ImmutableRelation</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@loaded</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ImmutableRelation</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@arel</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@arel</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-association_for_table" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">association_for_table</span><span
            class="method-args">(table_name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="association_for_table-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1011</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">association_for_table</span>(<span class="ruby-identifier">table_name</span>)
  <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">_reflect_on_association</span>(<span class="ruby-identifier">table_name</span>) <span class="ruby-operator">||</span>
    <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">_reflect_on_association</span>(<span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">singularize</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-build_arel" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_arel</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="build_arel-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 959</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_arel</span>
  <span class="ruby-identifier">arel</span> = <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">SelectManager</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">table</span>)

  <span class="ruby-identifier">build_joins</span>(<span class="ruby-identifier">arel</span>, <span class="ruby-identifier">joins_values</span>.<span class="ruby-identifier">flatten</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">joins_values</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">build_left_outer_joins</span>(<span class="ruby-identifier">arel</span>, <span class="ruby-identifier">left_outer_joins_values</span>.<span class="ruby-identifier">flatten</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">left_outer_joins_values</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where_clause</span>.<span class="ruby-identifier">ast</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">where_clause</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">having</span>(<span class="ruby-identifier">having_clause</span>.<span class="ruby-identifier">ast</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">having_clause</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">limit_value</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">string_containing_comma?</span>(<span class="ruby-identifier">limit_value</span>)
      <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">take</span>(<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">sanitize_limit</span>(<span class="ruby-identifier">limit_value</span>))
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">take</span>(<span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Nodes</span><span class="ruby-operator">::</span><span class="ruby-constant">BindParam</span>.<span class="ruby-identifier">new</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Nodes</span><span class="ruby-operator">::</span><span class="ruby-constant">BindParam</span>.<span class="ruby-identifier">new</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">offset_value</span>
  <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">group</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">arel_columns</span>(<span class="ruby-identifier">group_values</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">reject</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:blank?</span>))) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">group_values</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">build_order</span>(<span class="ruby-identifier">arel</span>)

  <span class="ruby-identifier">build_select</span>(<span class="ruby-identifier">arel</span>)

  <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">distinct</span>(<span class="ruby-identifier">distinct_value</span>)
  <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">from</span>(<span class="ruby-identifier">build_from</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">from_clause</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">lock</span>(<span class="ruby-identifier">lock_value</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">lock_value</span>

  <span class="ruby-identifier">arel</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-build_from" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_from</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="build_from-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1017</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_from</span>
  <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">from_clause</span>.<span class="ruby-identifier">value</span>
  <span class="ruby-identifier">name</span> = <span class="ruby-identifier">from_clause</span>.<span class="ruby-identifier">name</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">opts</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Relation</span>
    <span class="ruby-identifier">name</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;subquery&#39;</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">arel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-build_join_query" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_join_query</span><span
            class="method-args">(manager, buckets, join_type)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="build_join_query-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1061</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_join_query</span>(<span class="ruby-identifier">manager</span>, <span class="ruby-identifier">buckets</span>, <span class="ruby-identifier">join_type</span>)
  <span class="ruby-identifier">buckets</span>.<span class="ruby-identifier">default</span> = []

  <span class="ruby-identifier">association_joins</span>         = <span class="ruby-identifier">buckets</span>[<span class="ruby-value">:association_join</span>]
  <span class="ruby-identifier">stashed_association_joins</span> = <span class="ruby-identifier">buckets</span>[<span class="ruby-value">:stashed_join</span>]
  <span class="ruby-identifier">join_nodes</span>                = <span class="ruby-identifier">buckets</span>[<span class="ruby-value">:join_node</span>].<span class="ruby-identifier">uniq</span>
  <span class="ruby-identifier">string_joins</span>              = <span class="ruby-identifier">buckets</span>[<span class="ruby-value">:string_join</span>].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:strip</span>).<span class="ruby-identifier">uniq</span>

  <span class="ruby-identifier">join_list</span> = <span class="ruby-identifier">join_nodes</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">convert_join_strings_to_ast</span>(<span class="ruby-identifier">manager</span>, <span class="ruby-identifier">string_joins</span>)

  <span class="ruby-identifier">join_dependency</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Associations</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinDependency</span>.<span class="ruby-identifier">new</span>(
    <span class="ruby-ivar">@klass</span>,
    <span class="ruby-identifier">association_joins</span>,
    <span class="ruby-identifier">join_list</span>
  )

  <span class="ruby-identifier">join_infos</span> = <span class="ruby-identifier">join_dependency</span>.<span class="ruby-identifier">join_constraints</span> <span class="ruby-identifier">stashed_association_joins</span>, <span class="ruby-identifier">join_type</span>

  <span class="ruby-identifier">join_infos</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">info</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">info</span>.<span class="ruby-identifier">joins</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">join</span><span class="ruby-operator">|</span> <span class="ruby-identifier">manager</span>.<span class="ruby-identifier">from</span>(<span class="ruby-identifier">join</span>) }
    <span class="ruby-identifier">manager</span>.<span class="ruby-identifier">bind_values</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">info</span>.<span class="ruby-identifier">binds</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">manager</span>.<span class="ruby-identifier">join_sources</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">join_list</span>)

  <span class="ruby-identifier">manager</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-build_joins" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_joins</span><span
            class="method-args">(manager, joins)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="build_joins-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1042</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_joins</span>(<span class="ruby-identifier">manager</span>, <span class="ruby-identifier">joins</span>)
  <span class="ruby-identifier">buckets</span> = <span class="ruby-identifier">joins</span>.<span class="ruby-identifier">group_by</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">join</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">join</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
      <span class="ruby-value">:string_join</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>, <span class="ruby-constant">Symbol</span>, <span class="ruby-constant">Array</span>
      <span class="ruby-value">:association_join</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Associations</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinDependency</span>
      <span class="ruby-value">:stashed_join</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Nodes</span><span class="ruby-operator">::</span><span class="ruby-constant">Join</span>
      <span class="ruby-value">:join_node</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;unknown class: %s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">join</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">build_join_query</span>(<span class="ruby-identifier">manager</span>, <span class="ruby-identifier">buckets</span>, <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Nodes</span><span class="ruby-operator">::</span><span class="ruby-constant">InnerJoin</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-build_left_outer_joins" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_left_outer_joins</span><span
            class="method-args">(manager, outer_joins)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="build_left_outer_joins-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1029</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_left_outer_joins</span>(<span class="ruby-identifier">manager</span>, <span class="ruby-identifier">outer_joins</span>)
  <span class="ruby-identifier">buckets</span> = <span class="ruby-identifier">outer_joins</span>.<span class="ruby-identifier">group_by</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">join</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">join</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>, <span class="ruby-constant">Symbol</span>, <span class="ruby-constant">Array</span>
      <span class="ruby-value">:association_join</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&#39;only Hash, Symbol and Array are allowed&#39;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">build_join_query</span>(<span class="ruby-identifier">manager</span>, <span class="ruby-identifier">buckets</span>, <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Nodes</span><span class="ruby-operator">::</span><span class="ruby-constant">OuterJoin</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-build_order" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_order</span><span
            class="method-args">(arel)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="build_order-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1150</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_order</span>(<span class="ruby-identifier">arel</span>)
  <span class="ruby-identifier">orders</span> = <span class="ruby-identifier">order_values</span>.<span class="ruby-identifier">uniq</span>
  <span class="ruby-identifier">orders</span>.<span class="ruby-identifier">reject!</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:blank?</span>)

  <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">orders</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">orders</span>.<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-build_select" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_select</span><span
            class="method-args">(arel)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="build_select-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1096</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_select</span>(<span class="ruby-identifier">arel</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">select_values</span>.<span class="ruby-identifier">any?</span>
    <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">project</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">arel_columns</span>(<span class="ruby-identifier">select_values</span>.<span class="ruby-identifier">uniq</span>))
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">project</span>(<span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">arel_table</span>[<span class="ruby-constant">Arel</span>.<span class="ruby-identifier">star</span>])
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-check_if_method_has_arguments-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_if_method_has_arguments!</span><span
            class="method-args">(method_name, args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks to make sure that the arguments are not blank. Note that if some
blank-like object were initially passed into the query method, then this
method will not raise an error.</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-constant">Post</span>.<span class="ruby-identifier">references</span>()   <span class="ruby-comment"># raises an error</span>
<span class="ruby-constant">Post</span>.<span class="ruby-identifier">references</span>([]) <span class="ruby-comment"># does not raise an error</span>
</pre>

<p>This particular method should be called with a method_name and the args
passed into that method as an input. For example:</p>

<p>def references(*args)</p>

<pre>check_if_method_has_arguments!(&quot;references&quot;, args)
...</pre>

<p>end</p>
          
          

          
          <div class="method-source-code" id="check_if_method_has_arguments-21-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1212</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check_if_method_has_arguments!</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;The method .#{method_name}() must contain arguments.&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-convert_join_strings_to_ast" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">convert_join_strings_to_ast</span><span
            class="method-args">(table, joins)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="convert_join_strings_to_ast-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1089</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">convert_join_strings_to_ast</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">joins</span>)
  <span class="ruby-identifier">joins</span>
    .<span class="ruby-identifier">flatten</span>
    .<span class="ruby-identifier">reject</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:blank?</span>)
    .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">join</span><span class="ruby-operator">|</span> <span class="ruby-identifier">table</span>.<span class="ruby-identifier">create_string_join</span>(<span class="ruby-constant">Arel</span>.<span class="ruby-identifier">sql</span>(<span class="ruby-identifier">join</span>)) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-does_not_support_reverse-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">does_not_support_reverse?</span><span
            class="method-args">(order)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="does_not_support_reverse-3F-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1143</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">does_not_support_reverse?</span>(<span class="ruby-identifier">order</span>)
  <span class="ruby-comment"># Uses SQL function with multiple arguments.</span>
  (<span class="ruby-identifier">order</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;,&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;,&#39;</span>).<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&#39;(&#39;</span>) <span class="ruby-operator">!=</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&#39;)&#39;</span>)}) <span class="ruby-operator">||</span>
    <span class="ruby-comment"># Uses &quot;nulls first&quot; like construction.</span>
    <span class="ruby-identifier">order</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/nulls (first|last)\Z/i</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-having_clause_factory" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">having_clause_factory</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="QueryMethods.html#method-i-where_clause_factory">where_clause_factory</a>
        </div>
        
      </div>

    
      <div id="method-i-new_from_clause" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new_from_clause</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new_from_clause-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1234</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new_from_clause</span>
  <span class="ruby-constant">Relation</span><span class="ruby-operator">::</span><span class="ruby-constant">FromClause</span>.<span class="ruby-identifier">empty</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-new_having_clause" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">new_having_clause</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="QueryMethods.html#method-i-new_where_clause">new_where_clause</a>
        </div>
        
      </div>

    
      <div id="method-i-new_where_clause" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new_where_clause</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new_where_clause-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1224</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new_where_clause</span>
  <span class="ruby-constant">Relation</span><span class="ruby-operator">::</span><span class="ruby-constant">WhereClause</span>.<span class="ruby-identifier">empty</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="QueryMethods.html#method-i-new_having_clause">new_having_clause</a>
        </div>
        

        
      </div>

    
      <div id="method-i-preprocess_order_args" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">preprocess_order_args</span><span
            class="method-args">(order_args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="preprocess_order_args-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1170</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">preprocess_order_args</span>(<span class="ruby-identifier">order_args</span>)
  <span class="ruby-identifier">order_args</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:sanitize_sql_for_order</span>, <span class="ruby-identifier">arg</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">order_args</span>.<span class="ruby-identifier">flatten!</span>
  <span class="ruby-identifier">validate_order_args</span>(<span class="ruby-identifier">order_args</span>)

  <span class="ruby-identifier">references</span> = <span class="ruby-identifier">order_args</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-constant">String</span>)
  <span class="ruby-identifier">references</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">arg</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^([a-zA-Z]\w*)\.(\w+)/</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-node">$1</span> }.<span class="ruby-identifier">compact!</span>
  <span class="ruby-identifier">references!</span>(<span class="ruby-identifier">references</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">references</span>.<span class="ruby-identifier">any?</span>

  <span class="ruby-comment"># if a symbol is given we prepend the quoted table name</span>
  <span class="ruby-identifier">order_args</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span>
      <span class="ruby-identifier">arel_attribute</span>(<span class="ruby-identifier">arg</span>).<span class="ruby-identifier">asc</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
      <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">field</span>, <span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">arel_attribute</span>(<span class="ruby-identifier">field</span>).<span class="ruby-identifier">send</span>(<span class="ruby-identifier">dir</span>.<span class="ruby-identifier">downcase</span>)
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">flatten!</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reverse_sql_order" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reverse_sql_order</span><span
            class="method-args">(order_query)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="reverse_sql_order-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1116</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reverse_sql_order</span>(<span class="ruby-identifier">order_query</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">order_query</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-identifier">arel_attribute</span>(<span class="ruby-identifier">primary_key</span>).<span class="ruby-identifier">desc</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">primary_key</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">IrreversibleOrderError</span>,
      <span class="ruby-string">&quot;Relation has no current order and table has no primary key to be used as default order&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">order_query</span>.<span class="ruby-identifier">flat_map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">o</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Attribute</span>
      <span class="ruby-identifier">o</span>.<span class="ruby-identifier">desc</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Nodes</span><span class="ruby-operator">::</span><span class="ruby-constant">Ordering</span>
      <span class="ruby-identifier">o</span>.<span class="ruby-identifier">reverse</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">does_not_support_reverse?</span>(<span class="ruby-identifier">o</span>)
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">IrreversibleOrderError</span>, <span class="ruby-node">&quot;Order #{o.inspect} can not be reversed automatically&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">o</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;,&#39;</span>).<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">s</span>.<span class="ruby-identifier">strip!</span>
        <span class="ruby-identifier">s</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\sasc\Z/i</span>, <span class="ruby-string">&#39; DESC&#39;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\sdesc\Z/i</span>, <span class="ruby-string">&#39; ASC&#39;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-string">&#39; DESC&#39;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">o</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-string_containing_comma-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">string_containing_comma?</span><span
            class="method-args">(value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="string_containing_comma-3F-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1238</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">string_containing_comma?</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-operator">::</span><span class="ruby-constant">String</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;,&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-structurally_incompatible_values_for_or" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">structurally_incompatible_values_for_or</span><span
            class="method-args">(other)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="structurally_incompatible_values_for_or-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1218</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">structurally_incompatible_values_for_or</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-constant">Relation</span><span class="ruby-operator">::</span><span class="ruby-constant">SINGLE_VALUE_METHODS</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{m}_value&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{m}_value&quot;</span>) } <span class="ruby-operator">+</span>
    (<span class="ruby-constant">Relation</span><span class="ruby-operator">::</span><span class="ruby-constant">MULTI_VALUE_METHODS</span> <span class="ruby-operator">-</span> [<span class="ruby-value">:extending</span>]).<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{m}_values&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{m}_values&quot;</span>) } <span class="ruby-operator">+</span>
    (<span class="ruby-constant">Relation</span><span class="ruby-operator">::</span><span class="ruby-constant">CLAUSE_METHODS</span> <span class="ruby-operator">-</span> [<span class="ruby-value">:having</span>, <span class="ruby-value">:where</span>]).<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{m}_clause&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{m}_clause&quot;</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-symbol_unscoping" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">symbol_unscoping</span><span
            class="method-args">(scope)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="symbol_unscoping-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 988</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">symbol_unscoping</span>(<span class="ruby-identifier">scope</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">VALID_UNSCOPING_VALUES</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">scope</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;Called unscope() with invalid unscoping argument &#39;:#{scope}&#39;. Valid arguments are :#{VALID_UNSCOPING_VALUES.to_a.join(&quot;, :&quot;)}.&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">clause_method</span> = <span class="ruby-constant">Relation</span><span class="ruby-operator">::</span><span class="ruby-constant">CLAUSE_METHODS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">scope</span>)
  <span class="ruby-identifier">multi_val_method</span> = <span class="ruby-constant">Relation</span><span class="ruby-operator">::</span><span class="ruby-constant">MULTI_VALUE_METHODS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">scope</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">clause_method</span>
    <span class="ruby-identifier">unscope_code</span> = <span class="ruby-node">&quot;#{scope}_clause=&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">unscope_code</span> = <span class="ruby-node">&quot;#{scope}_value#{&#39;s&#39; if multi_val_method}=&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">scope</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:order</span>
    <span class="ruby-identifier">result</span> = []
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">multi_val_method</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">unscope_code</span>, <span class="ruby-identifier">result</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validate_order_args" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate_order_args</span><span
            class="method-args">(args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="validate_order_args-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1160</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">validate_order_args</span>(<span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
    <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;Direction \&quot;#{value}\&quot; is invalid. Valid &quot;</span>                                 <span class="ruby-node">&quot;directions are: #{VALID_DIRECTIONS.inspect}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">VALID_DIRECTIONS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">value</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-where_clause_factory" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">where_clause_factory</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="where_clause_factory-source">
            <pre><span class="ruby-comment"># File lib/active_record/relation/query_methods.rb, line 1229</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">where_clause_factory</span>
  <span class="ruby-ivar">@where_clause_factory</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Relation</span><span class="ruby-operator">::</span><span class="ruby-constant">WhereClauseFactory</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">klass</span>, <span class="ruby-identifier">predicate_builder</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="QueryMethods.html#method-i-having_clause_factory">having_clause_factory</a>
        </div>
        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.3.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

